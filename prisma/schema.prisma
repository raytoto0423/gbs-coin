datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// User = í•™ìƒ/ì„ ìƒ/ê´€ë¦¬ì ê³„ì •
model User {
  id      String @id @default(cuid())
  email   String @unique
  name    String
  role    String

  balance Int    @default(0)
  classId String?

  grade     Int?
  classRoom Int?
  number    Int?
  classRole String?

  transactionsSent     Transaction[] @relation("UserFrom")
  transactionsReceived Transaction[] @relation("UserTo")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Booth = ë¶€ìŠ¤ ê³„ì • (í•™ê¸‰ ë¶€ìŠ¤/í–‰ì‚¬ ë¶€ìŠ¤ ë“±)
model Booth {
  id           String @id    // ì˜ˆ: "1-1", "2-3" ê°™ì€ í˜•íƒœ
  name         String
  passwordHash String        // ë¶€ìŠ¤ ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ
  balance      Int    @default(0)

  // ğŸ”¥ ìƒˆë¡œ ì¶”ê°€í•œ ë¶€ìŠ¤ í•™ê¸‰ ì •ë³´
  grade     Int?             // ì´ ë¶€ìŠ¤ê°€ ë‹´ë‹¹í•˜ëŠ” í•™ë…„ (í•™ê¸‰ ë¶€ìŠ¤ì¼ ê²½ìš°)
  classRoom Int?             // ì´ ë¶€ìŠ¤ê°€ ë‹´ë‹¹í•˜ëŠ” ë°˜

  activities           Activity[]
  transactionsSent     Transaction[] @relation("BoothFrom")
  transactionsReceived Transaction[] @relation("BoothTo")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Activity {
  id      String @id @default(cuid())
  booth   Booth  @relation(fields: [boothId], references: [id])
  boothId String

  title String
  price Int
  type  String             // "PAY" | "REWARD"ë¥¼ ë¬¸ìì—´ë¡œ ì €ì¥

  isActive Boolean @default(true)

  transactions Transaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Transaction {
  id String @id @default(cuid())

  fromUser   User?  @relation("UserFrom", fields: [fromUserId], references: [id])
  fromUserId String?

  toUser   User?  @relation("UserTo", fields: [toUserId], references: [id])
  toUserId String?

  fromBooth   Booth?  @relation("BoothFrom", fields: [fromBoothId], references: [id])
  fromBoothId String?

  toBooth   Booth?  @relation("BoothTo", fields: [toBoothId], references: [id])
  toBoothId String?

  amount Int
  title  String

  activity   Activity? @relation(fields: [activityId], references: [id])
  activityId String?

  createdAt DateTime @default(now())
}
