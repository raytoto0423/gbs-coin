datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

// ⚠️ enum 삭제하고, 아래 모델들에서 role/type을 String으로 사용

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String
  role      String              // "STUDENT" | "TEACHER" | "ADMIN" 같은 문자열로 사용
  balance   Int      @default(0)
  classId   String?

  transactionsSent     Transaction[] @relation("UserFrom")
  transactionsReceived Transaction[] @relation("UserTo")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Booth {
  id           String   @id         // 예: "1-1", "2-3"
  name         String
  passwordHash String               // 반장 폰 뒤 4자리 해시
  balance      Int      @default(0)

  activities          Activity[]
  transactionsSent     Transaction[] @relation("BoothFrom")
  transactionsReceived Transaction[] @relation("BoothTo")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Activity {
  id        String   @id @default(cuid())
  booth     Booth    @relation(fields: [boothId], references: [id])
  boothId   String

  title     String
  price     Int
  type      String             // "PAY" | "REWARD"를 문자열로 저장

  isActive  Boolean  @default(true)

  transactions Transaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Transaction {
  id          String   @id @default(cuid())

  fromUser    User?    @relation("UserFrom", fields: [fromUserId], references: [id])
  fromUserId  String?

  toUser      User?    @relation("UserTo", fields: [toUserId], references: [id])
  toUserId    String?

  fromBooth   Booth?   @relation("BoothFrom", fields: [fromBoothId], references: [id])
  fromBoothId String?

  toBooth     Booth?   @relation("BoothTo", fields: [toBoothId], references: [id])
  toBoothId   String?

  amount      Int
  title       String

  activity    Activity? @relation(fields: [activityId], references: [id])
  activityId  String?

  createdAt   DateTime @default(now())
}
